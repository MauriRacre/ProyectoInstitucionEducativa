<div class="min-h-screen bg-gray-50">
    <div class="w-full px-5 sm:px-10 lg:px-20 py-10">
        <!-- Header -->
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-3xl font-semibold text-gray-900">Directorio de Tutores y Alumnos</h1>
                <p class="text-sm text-gray-500">Gestiona tutores, alumnos y balances de forma rápida.</p>
            </div>
            <button
                type="button"
                (click)="onNewTutor()"
                class="inline-flex items-center justify-center gap-2 rounded-xl bg-celeste px-4 py-2.5 text-sm font-semibold text-white shadow-md hover:bg-azul"
            >
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v14M5 12h14" />
                </svg>
                <span>Nuevo Tutor</span>
            </button>
        </div>
        <!-- Controls -->
        <div class="mt-6 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">

            <!-- Search -->
            <div class="w-full lg:max-w-md">
                <label class="sr-only" for="search">Buscar tutor, email, teléfono o alumno</label>
                <div class="relative">
                <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-gray-400">
                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z"/>
                    </svg>
                </span>
                <input
                    id="search"
                    type="text"
                    [(ngModel)]="query"
                    (ngModelChange)="onQueryChange()"
                    placeholder="Buscar… (nombre, email, alumno)"
                    class="w-full rounded-xl border border-gray-200 bg-white py-2.5 pl-11 pr-3 text-sm text-gray-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
                />
                </div>
            </div>

            <!-- Tabs -->
            <div class="w-full lg:w-auto">
                <div class="inline-flex w-full rounded-2xl border border-gray-200 bg-white p-1 shadow-sm lg:w-auto" role="tablist" aria-label="Filtros de estado">
                <button
                    type="button"
                    role="tab"
                    [attr.aria-selected]="selectedTab === 'all'"
                    (click)="setTab('all')"
                    class="flex-1 rounded-xl px-4 py-2 text-sm font-semibold transition lg:flex-none"
                    [ngClass]="selectedTab === 'all'
                    ? 'bg-gray-900 text-white shadow'
                    : 'text-gray-700 hover:bg-gray-50'"
                >
                    Todos
                    <span class="ml-2 rounded-full px-2 py-0.5 text-xs"
                    [ngClass]="selectedTab === 'all' ? 'bg-white/15 text-white' : 'bg-gray-100 text-gray-700'">
                    {{ counts.all }}
                    </span>
                </button>

                <button
                    type="button"
                    role="tab"
                    [attr.aria-selected]="selectedTab === 'debt'"
                    (click)="setTab('debt')"
                    class="flex-1 rounded-xl px-4 py-2 text-sm font-semibold transition lg:flex-none"
                    [ngClass]="selectedTab === 'debt'
                    ? 'bg-rojo text-white shadow'
                    : 'text-gray-700 hover:bg-gray-50'"
                >
                    Con deuda
                    <span class="ml-2 rounded-full px-2 py-0.5 text-xs"
                    [ngClass]="selectedTab === 'debt' ? 'bg-white/15 text-white' : 'bg-gray-100 text-gray-700'">
                    {{ counts.debt }}
                    </span>
                </button>

                <button
                    type="button"
                    role="tab"
                    [attr.aria-selected]="selectedTab === 'ok'"
                    (click)="setTab('ok')"
                    class="flex-1 rounded-xl px-4 py-2 text-sm font-semibold transition lg:flex-none"
                    [ngClass]="selectedTab === 'ok'
                    ? 'bg-verde text-white shadow'
                    : 'text-gray-700 hover:bg-gray-50'"
                >
                    Al día
                    <span class="ml-2 rounded-full px-2 py-0.5 text-xs"
                    [ngClass]="selectedTab === 'ok' ? 'bg-white/15 text-white' : 'bg-gray-100 text-gray-700'">
                    {{ counts.ok }}
                    </span>
                </button>
                </div>
            </div>
        </div>
        <!-- Table Card -->
        <div class="mt-6 overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-md">
            <div class="overflow-x-auto">
                <table class="min-w-full text-left text-sm">
                    <thead class="bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-600">
                        <tr>
                        <th class="px-5 py-3">Nombre</th>
                        <th class="px-5 py-3">Contacto</th>
                        <th class="px-5 py-3">Alumnos</th>
                        <th class="px-5 py-3">Balance</th>
                        <th class="px-5 py-3 text-right">Acciones</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-100">
                        <tr *ngFor="let t of pagedTutors; trackBy: trackById" class="hover:bg-gray-50/70">
                        <td class="px-5 py-4">
                            <div class="font-semibold text-gray-900">{{ t.name }}</div>
                        </td>

                        <td class="px-5 py-4">
                            <div class="text-gray-900 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="w-3 mr-1 mt-1">
                                    <path d="M125.4 128C91.5 128 64 155.5 64 189.4C64 190.3 64 191.1 64.1 192L64 192L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 192L575.9 192C575.9 191.1 576 190.3 576 189.4C576 155.5 548.5 128 514.6 128L125.4 128zM528 256.3L528 448C528 456.8 520.8 464 512 464L128 464C119.2 464 112 456.8 112 448L112 256.3L266.8 373.7C298.2 397.6 341.7 397.6 373.2 373.7L528 256.3zM112 189.4C112 182 118 176 125.4 176L514.6 176C522 176 528 182 528 189.4C528 193.6 526 197.6 522.7 200.1L344.2 335.5C329.9 346.3 310.1 346.3 295.8 335.5L117.3 200.1C114 197.6 112 193.6 112 189.4z"/>
                                </svg>
                                {{ t.email }}
                            </div>
                            <div class="text-gray-600 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="w-3 mr-1">
                                    <path d="M144 128C144 92.7 172.7 64 208 64L432 64C467.3 64 496 92.7 496 128L496 512C496 547.3 467.3 576 432 576L208 576C172.7 576 144 547.3 144 512L144 128zM208 128L208 432L432 432L432 128L208 128zM320 536C337.7 536 352 521.7 352 504C352 486.3 337.7 472 320 472C302.3 472 288 486.3 288 504C288 521.7 302.3 536 320 536z"/>
                                </svg>
                                {{ t.phone }}
                            </div>
                        </td>

                        <td class="px-5 py-4">
                            <ul class="space-y-1">
                            <li *ngFor="let s of t.students" class="text-gray-700">
                                {{ s }}
                            </li>
                            </ul>
                        </td>

                        <td class="px-5 py-4">
                            <div class="flex flex-col md:flex-row gap-1">
                                <div class="font-semibold text-gray-900 mr-1">
                                    Bs. {{ t.balance | number:'1.0-0' }}
                                </div>

                                <span
                                    class="w-fit rounded-xl px-2.5 py-1 text-xs font-semibold"
                                    [ngClass]="t.balance < 0 ? 'bg-red-50 text-rojo border border-red-100' : 'bg-emerald-50 text-verde border border-emerald-100'"
                                >
                                    {{ t.balance < 0 ? 'Con deuda' : 'Al día' }}
                                </span>
                            </div>
                        </td>

                        <td class="px-5 py-4">
                            <div class="flex justify-end gap-2">
                                <button
                                    type="button"
                                    [routerLink]="['/cobro-tutor', t.id]"
                                    class="inline-flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm font-semibold text-gray-800 hover:bg-blue-100 focus:outline-none"
                                    title="Registrar cobro"
                                >
                                    <svg class="h-5 w-5 text-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7H14a3.5 3.5 0 0 1 0 7H6" />
                                    </svg>
                                    Cobro
                                </button>
                            </div>
                        </td>
                        </tr>

                        <!-- Empty state -->
                        <tr *ngIf="pagedTutors.length === 0">
                        <td colspan="5" class="px-5 py-10 text-center">
                            <div class="text-sm font-semibold text-gray-900">No se encontraron resultados</div>
                            <div class="mt-1 text-sm text-gray-500">Prueba cambiar el filtro o la búsqueda.</div>
                        </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="flex flex-col gap-3 border-t border-gray-100 bg-white px-5 py-4 sm:flex-row sm:items-center sm:justify-between">
                <div class="text-sm text-gray-600">
                    Mostrando
                    <span class="font-semibold text-gray-900">{{ pageStart + 1 }}</span>
                    –
                    <span class="font-semibold text-gray-900">{{ pageEnd }}</span>
                    de
                    <span class="font-semibold text-gray-900">{{ total }}</span>
                </div>
                <nav class="flex items-center gap-1" aria-label="Pagination">

                    <!-- Prev -->
                    <button
                    (click)="goToPage(page - 1)"
                    [disabled]="page === 1"
                    class="flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-40"
                    >
                    ‹
                    </button>

                    <!-- Page numbers -->
                    <ng-container *ngFor="let p of visiblePages">
                    <button
                        *ngIf="p !== '...'; else dots"
                        (click)="goToPage(p)"
                        class="h-9 w-9 rounded-lg text-sm font-semibold transition"
                        [ngClass]="p === page
                        ? 'bg-gray-900 text-white'
                        : 'border border-gray-200 bg-white text-gray-700 hover:bg-gray-50'"
                    >
                        {{ p }}
                    </button>

                    <ng-template #dots>
                        <span class="px-2 text-gray-400">…</span>
                    </ng-template>
                    </ng-container>

                    <!-- Next -->
                    <button
                    (click)="goToPage(page + 1)"
                    [disabled]="page === totalPages"
                    class="flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-40"
                    >
                    ›
                    </button>

                </nav>
            </div>
        </div>
        <!--Modal de nuevo tutor-->
        <app-modal-register
            [open]="openModal"
            [mode]="mode"
            [value]="null"
            [loading]="saving"
            (close)="openModal = false"
            (submitForm)="onRegister($event)"
        ></app-modal-register>
    </div>
</div>
