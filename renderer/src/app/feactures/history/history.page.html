<div class="min-h-screen bg-gray-50">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">

    <!-- Header -->
    <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900">Historial de Transacciones</h1>
        <p class="text-sm text-gray-500">Consulta pagos, descuentos y reversiones con filtros y exportación.</p>
      </div>

      <div class="flex flex-wrap gap-2">
        <button
          type="button"
          (click)="exportPdf()"
          class="inline-flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-4 py-2.5 text-sm font-semibold text-gray-800 shadow-sm hover:bg-gray-50"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="h-5 w-5">
            <path d="M240 112L128 112C119.2 112 112 119.2 112 128L112 512C112 520.8 119.2 528 128 528L208 528L208 576L128 576C92.7 576 64 547.3 64 512L64 128C64 92.7 92.7 64 128 64L261.5 64C278.5 64 294.8 70.7 306.8 82.7L429.3 205.3C441.3 217.3 448 233.6 448 250.6L448 400.1L400 400.1L400 272.1L312 272.1C272.2 272.1 240 239.9 240 200.1L240 112.1zM380.1 224L288 131.9L288 200C288 213.3 298.7 224 312 224L380.1 224z"/>
          </svg>
          Exportar PDF
        </button>

        <button
          type="button"
          (click)="newTransaction()"
          class="inline-flex items-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-700"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="h-5 w-5">
            <path d="M352 128C352 110.3 337.7 96 320 96C302.3 96 288 110.3 288 128L288 288L128 288C110.3 288 96 302.3 96 320C96 337.7 110.3 352 128 352L288 352L288 512C288 529.7 302.3 544 320 544C337.7 544 352 529.7 352 512L352 352L512 352C529.7 352 544 337.7 544 320C544 302.3 529.7 288 512 288L352 288L352 128z"/>
          </svg>
          Nueva
        </button>
      </div>
    </div>

    <!-- Cards -->
    <div class="mt-6 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4">
      <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-sm font-semibold text-gray-700">Ingresos totales</div>
          <span class="inline-flex p-1.5 items-center justify-center rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="w-5" fill="currentColor"> <path d="M416 224C398.3 224 384 209.7 384 192C384 174.3 398.3 160 416 160L576 160C593.7 160 608 174.3 608 192L608 352C608 369.7 593.7 384 576 384C558.3 384 544 369.7 544 352L544 269.3L374.6 438.7C362.1 451.2 341.8 451.2 329.3 438.7L224 333.3L86.6 470.6C74.1 483.1 53.8 483.1 41.3 470.6C28.8 458.1 28.8 437.8 41.3 425.3L201.3 265.3C213.8 252.8 234.1 252.8 246.6 265.3L352 370.7L498.7 224L416 224z"/> </svg>
          </span>
        </div>
        <div class="mt-2 text-2xl font-bold text-gray-900">Bs. {{ kpis.totalIncome | number:'1.2-2' }}</div>
        <div class="mt-1 text-xs text-gray-500">Suma de pagos aplicados (neto).</div>
      </div>

      <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-sm font-semibold text-gray-700">Ingresos del mes</div>
          <span class="inline-flex p-1.5 items-center justify-center rounded-full bg-blue-50 text-blue-700 border border-blue-100">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="w-5" fill="currentColor"><path d="M216 64C229.3 64 240 74.7 240 88L240 128L400 128L400 88C400 74.7 410.7 64 424 64C437.3 64 448 74.7 448 88L448 128L480 128C515.3 128 544 156.7 544 192L544 480C544 515.3 515.3 544 480 544L160 544C124.7 544 96 515.3 96 480L96 192C96 156.7 124.7 128 160 128L192 128L192 88C192 74.7 202.7 64 216 64zM216 176L160 176C151.2 176 144 183.2 144 192L144 240L496 240L496 192C496 183.2 488.8 176 480 176L216 176zM144 288L144 480C144 488.8 151.2 496 160 496L480 496C488.8 496 496 488.8 496 480L496 288L144 288z"/> </svg>
          </span>
        </div>
        <div class="mt-2 text-2xl font-bold text-gray-900">Bs. {{ kpis.monthIncome | number:'1.2-2' }}</div>
        <div class="mt-1 text-xs text-gray-500">Pagos del mes actual.</div>
      </div>

      <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-sm font-semibold text-gray-700">Descuentos</div>
          <span class="inline-flex p-1.5 items-center justify-center rounded-full bg-amber-50 text-amber-700 border border-amber-100">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="w-4"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M288 192C288 139 245 96 192 96C139 96 96 139 96 192C96 245 139 288 192 288C245 288 288 245 288 192zM544 448C544 395 501 352 448 352C395 352 352 395 352 448C352 501 395 544 448 544C501 544 544 501 544 448zM534.6 150.6C547.1 138.1 547.1 117.8 534.6 105.3C522.1 92.8 501.8 92.8 489.3 105.3L105.3 489.3C92.8 501.8 92.8 522.1 105.3 534.6C117.8 547.1 138.1 547.1 150.6 534.6L534.6 150.6z"/></svg>  
        </span>
        </div>
        <div class="mt-2 text-2xl font-bold text-gray-900">Bs. {{ kpis.totalDiscounts | number:'1.2-2' }}</div>
        <div class="mt-1 text-xs text-gray-500">Descuentos registrados.</div>
      </div>

      <div class="rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <div class="text-sm font-semibold text-gray-700">Reversiones</div>
          <span class="inline-flex p-1.5 items-center justify-center rounded-full bg-red-50 text-red-700 border border-red-100">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentColor" class="w-4"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M320 128C263.2 128 212.1 152.7 176.9 192L224 192C241.7 192 256 206.3 256 224C256 241.7 241.7 256 224 256L96 256C78.3 256 64 241.7 64 224L64 96C64 78.3 78.3 64 96 64C113.7 64 128 78.3 128 96L128 150.7C174.9 97.6 243.5 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576C233 576 156.1 532.6 109.9 466.3C99.8 451.8 103.3 431.9 117.8 421.7C132.3 411.5 152.2 415.1 162.4 429.6C197.2 479.4 254.8 511.9 320 511.9C426 511.9 512 425.9 512 319.9C512 213.9 426 128 320 128z"/></svg>
          </span>
        </div>
        <div class="mt-2 text-2xl font-bold text-gray-900">{{ kpis.totalReversals }}</div>
        <div class="mt-1 text-xs text-gray-500">Cantidad de movimientos revertidos.</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="mt-6 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm">
      <div class="grid grid-cols-1 gap-4 lg:grid-cols-12 lg:items-end">

        <!-- Search -->
        <div class="lg:col-span-5">
          <label class="text-xs font-semibold text-gray-600">BÚSQUEDA</label>
          <div class="mt-2 relative">
            <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-gray-400">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="h-5 w-5" fill="currentColor">
                <path d="M480 272C480 317.9 465.1 360.3 440 394.7L566.6 521.4C579.1 533.9 579.1 554.2 566.6 566.7C554.1 579.2 533.8 579.2 521.3 566.7L394.7 440C360.3 465.1 317.9 480 272 480C157.1 480 64 386.9 64 272C64 157.1 157.1 64 272 64C386.9 64 480 157.1 480 272zM272 416C351.5 416 416 351.5 416 272C416 192.5 351.5 128 272 128C192.5 128 128 192.5 128 272C128 351.5 192.5 416 272 416z"/>
              </svg>
            </span>
            <input
              [(ngModel)]="filters.q"
              (ngModelChange)="applyFilters()"
              type="text"
              placeholder="Buscar por tutor, alumno, encargado o concepto…"
              class="w-full rounded-xl border border-gray-200 bg-white py-2.5 pl-11 pr-3 text-sm text-gray-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
            />
          </div>
        </div>

        <!-- Date range -->
        <div class="lg:col-span-4">
          <label class="text-xs font-semibold text-gray-600">RANGO DE FECHAS</label>
          <div class="mt-2 grid grid-cols-2 gap-2">
            <input
              [(ngModel)]="filters.from"
              (ngModelChange)="applyFilters()"
              type="date"
              class="w-full rounded-xl border border-gray-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
            />
            <input
              [(ngModel)]="filters.to"
              (ngModelChange)="applyFilters()"
              type="date"
              class="w-full rounded-xl border border-gray-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
            />
          </div>
        </div>

        <!-- Concept -->
        <div class="lg:col-span-2">
          <label class="text-xs font-semibold text-gray-600">CONCEPTO</label>
          <select
            [(ngModel)]="filters.concept"
            (ngModelChange)="applyFilters()"
            class="mt-2 w-full rounded-xl border border-gray-200 bg-white px-3 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
          >
            <option value="">Todos</option>
            <option *ngFor="let c of concepts" [value]="c">{{ c }}</option>
          </select>
        </div>

        <!-- Actions -->
        <div class="lg:col-span-1 flex gap-2 lg:justify-end">
          <button
            type="button"
            (click)="resetFilters()"
            class="inline-flex w-full items-center justify-center rounded-xl border border-gray-200 bg-white px-3 py-2.5 text-sm font-semibold text-gray-800 hover:bg-gray-50"
            title="Limpiar filtros"
          >
            Limpiar
          </button>
        </div>

      </div>
    </div>

    <!-- Table -->
    <div class="mt-6 overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-md">
      <div class="overflow-x-auto">
        <table class="min-w-full text-left text-sm">
          <thead class="bg-gray-50 text-xs font-semibold uppercase tracking-wide text-gray-600">
            <tr>
              <th class="px-5 py-3">Fecha</th>
              <th class="px-5 py-3">Tipo</th>
              <th class="px-5 py-3">Encargado</th>
              <th class="px-5 py-3">Tutor</th>
              <th class="px-5 py-3">Alumno</th>
              <th class="px-5 py-3">Concepto</th>
              <th class="px-5 py-3 text-right">Monto</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let t of paged; trackBy: trackById" class="hover:bg-gray-50/70">
              <td class="px-5 py-4">
                <div class="font-semibold text-gray-900">{{ formatDate(t.dateISO) }}</div>
                <div class="text-xs text-gray-500">{{ t.time }}</div>
              </td>

              <td class="px-5 py-4">
                <span class="inline-flex rounded-full px-2.5 py-1 text-xs font-semibold border"
                      [ngClass]="typePillClass(t.type)">
                  {{ typeLabel(t.type) }}
                </span>
              </td>

              <td class="px-5 py-4">
                <div class="font-semibold text-gray-900">{{ t.staff }}</div>
              </td>

              <td class="px-5 py-4">
                <div class="font-semibold text-gray-900">{{ t.tutor }}</div>
              </td>

              <td class="px-5 py-4">
                <div class="font-semibold text-gray-900">{{ t.student }}</div>
                <div class="text-xs text-gray-500">{{ t.grade }} - {{ t.parallel }}</div>
              </td>

              <td class="px-5 py-4">
                <div class="font-semibold text-gray-900">{{ t.concept }}</div>
                <div class="text-xs text-gray-500" *ngIf="t.note">{{ t.note }}</div>
              </td>

              <td class="px-5 py-4 text-right">
                <div class="font-bold" [ngClass]="amountClass(t.type)">
                  {{ amountPrefix(t.type) }} Bs. {{ t.amount | number:'1.2-2' }}
                </div>
              </td>
            </tr>

            <tr *ngIf="filtered.length === 0">
              <td colspan="7" class="px-5 py-12 text-center">
                <div class="text-sm font-semibold text-gray-900">No se encontraron resultados</div>
                <div class="mt-1 text-sm text-gray-500">Prueba cambiar filtros o búsqueda.</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex flex-col gap-3 border-t border-gray-100 bg-white px-5 py-4 sm:flex-row sm:items-center sm:justify-between">
        <div class="text-sm text-gray-600">
          Mostrando
          <span class="font-semibold text-gray-900">{{ pageStart + 1 }}</span>
          –
          <span class="font-semibold text-gray-900">{{ pageEnd }}</span>
          de
          <span class="font-semibold text-gray-900">{{ filtered.length }}</span>
        </div>

        <nav class="flex items-center gap-1" aria-label="Pagination">
          <button
            type="button"
            (click)="goToPage(page - 1)"
            [disabled]="page === 1"
            class="flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-40"
          >‹</button>

          <ng-container *ngFor="let p of visiblePages">
            <button
              *ngIf="p !== '...'; else dots"
              type="button"
              (click)="goToPage(p)"
              class="h-9 w-9 rounded-lg text-sm font-semibold transition"
              [ngClass]="p === page
                ? 'bg-gray-900 text-white'
                : 'border border-gray-200 bg-white text-gray-700 hover:bg-gray-50'"
            >
              {{ p }}
            </button>

            <ng-template #dots>
              <span class="px-2 text-gray-400">…</span>
            </ng-template>
          </ng-container>

          <button
            type="button"
            (click)="goToPage(page + 1)"
            [disabled]="page === totalPages"
            class="flex h-9 w-9 items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-700 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-40"
          >›</button>
        </nav>
      </div>
    </div>

  </div>
</div>
